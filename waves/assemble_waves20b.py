#!/usr/bin/env python3

# assemble NCHAN waveforms in raw mux format suitable for AWG load
'''
Test:
[pgm@hoy5 waves]$ ./assemble_waves.py
[pgm@hoy5 waves]$ hexdump -e '32/2 "%04x," "\n"' 32interleaved.dat | head
0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0000,0001,0002,0003,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0001,0003,0004,0006,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0002,0004,0007,0009,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0003,0006,0009,000d,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0004,0008,000c,0010,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0004,0009,000e,0013,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0005,000b,0011,0017,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
0006,000d,0013,001a,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,0000,
...
'''
import numpy as np
import matplotlib.pyplot as plt


NSAM=int(250e3)    # 1s at 250kHz
NCHAN=8
MAXCODE=(1<<19)

x = np.linspace(0, 2*500*np.pi, NSAM)
y = np.sin(x) 
#plt.plot(y)
#plt.show()

z = np.zeros(NSAM)



# now create a "random" selection of waveforms. Most are Z
waves = [ z for ch in range(0, NCHAN)]

for ch in range(0,4):
    waves[ch] = y
#    waves[ch] = y*(ch+1)   # ch1..4 1V,2V,3V,4V



mux = np.zeros((NSAM,NCHAN))

for ch, wf in enumerate(waves):
    mux[:,ch] = wf * MAXCODE/2000

# final scale to raw on the way out

raw = mux.astype(np.int32).tofile("8CH_500Hz_20b.dat")




